---
title: "DNS"
date: 2021-12-10T17:40:54+08:00
draft: false
tags:
 - DNS
---

### HTTP

HTTP (HyperText Transfer Protocol)，**超文本传输协议**。

HTTP 是一个在计算机世界里专门在两点之间传输文字、图片、音频、视频等**超文本**数据的约定和规范。



### CDN

Content Delivery Network, 内容分发网络。它**应用了HTTP协议里的缓存和代理技术，代替源站响应客户端的请求**。

它可以缓存源站的数据，让浏览器的请求不用“千里迢迢”地到达源站服务器， 直接在“半路”就可以获取响应。如果 CDN 的调度算法很优秀，更可以找到离用户最近的节点，大幅度缩短响应时间。

CDN位于浏览器和服务器之间，主要起到缓存加速的作用。

### Web Service

由W3C定义的应用服务开发规范，使用Client-Server主从架构，通常使用 WSDL 定义服务接口，使用 HTTP 协议传输 XML 或 SOAP 消息，也就是说，它是**一个基于 Web（HTTP）的服务架构技术**，既可以运行在内网，也可以在适当保护后运行在外网。



### WAF

网络应用防火墙。与硬件“防火墙”类似，它是应用层面的“防火墙”，专门检测 HTTP 流量，是防护 Web 应用的安全技术。

WAF 通常位于 Web 服务器之前，可以阻止如 SQL 注入、跨站脚本等攻击，目前应用较多的一个开源项目是 ModSecurity，它能够完全集成进 Apache 或 Nginx。



### URI URL

DNS 和 IP 地址标记了互联网上的主机，URI标记的是我们到底要找哪个文件。

URI（Uniform Resource Identifier）统一资源**标识**符，使用它就能够唯一地标记互联网上的资源

URL（Uniform Resource Locator）统一资源**定位符**，也就是我们常说的网址，它实际上是URI的子集，但两者几乎相同，差异不大，通常不会做严格区分，可能写论文需要区分。

URI 是用来标记互联网上资源的一个名字，由“**协议名 + 主机名 + 路径**”构成，俗称 URL

URI 是统一资源标识符，标定了客户端需要访问的资源所处的位置，如果URI中的主机名使用域名，则需要使用DNS来讲域名解析为IP。

### HTTPS

HTTP over SSL/TLS，**运行在 SSL/TLS 协议上的HTTP**。 

SSL/TLS 是一个负责加密通信的安全协议，建立在 TCP/IP 之上。

**SSL 的全称是“ Secure Socket Layer ”**，由网景公司发明，当发展到 3.0 时被标准化，**改名为 TLS，即“Transport Layer Security”**，但由于历史的原因还是有很多人称之为SSL/TLS，或者直接简称为 SSL。

HTTPS 相当于**“HTTP+SSL/TLS+TCP/IP**”，为 HTTP 套了一个安全的外壳；



### 代理

代理（Proxy）是 HTTP 协议中请求方和应答方中间的一个环节，作为“中转站”，既可以转发客户端的请求，也可以转发服务器的应答。

代理有很多的种类，常见的有：

1. 匿名代理：完全“隐匿”了被代理的机器，外界看到的只是代理服务器；
2. 透明代理：顾名思义，它在传输过程中是“透明开放”的，外界既知道代理，也知道客 
   户端；
3. 正向代理：靠近客户端，代表客户端向服务器发送请求；
4. 反向代理：靠近服务器端，代表服务器响应客户端的请求；



CDN，实际上就是一种代理，它代替源站服务器响应客户端的请求，通常扮演着透明代理和反向代理的角色。

由于代理在传输过程中插入了一个“中间层”，所以可以在这个环节做很多有意思的事情， 比如：

1. 负载均衡：把访问请求均匀分散到多台机器，实现访问集群化；

2. 内容缓存：暂存上下行的数据，减轻后端的压力；

3. 安全防护：隐匿 IP, 使用 WAF 等工具抵御网络攻击，保护被代理的机器；

4. 数据处理：提供压缩、加密等额外的功能。

   

### 🔥DNS

Domain Name System 域名系统， 是互联网使用的命名系统，用来把便于人们使用的域名转换为IP地址。**域名是大小写无关的**。

互联网的域名系统DNS被设计成一个联机**分布式数据库系统**，并采用客户服务器方式。

**域名到IP地址的解析**是由分布在互联网上的许多域名服务程序（简称**域名服务器**）共同完成的。

DNS的核心系统是一个三层的树状、分布式服务。对应域名的结构：

1. **根域名服务器 （Root DNS Server）**
   - 管理顶级域名服务器，返回“com” “net” “cn”等顶级域名服务器的 IP 地址；
   - 全世界目前有13组根域名服务器，又有数百台镜像。
2. **顶级域名服务器（Top-level DNS Server）**
   - 管理各自域名下的权威域名服务器，比如 com 顶级域名服务器可以返回 apple.com 域名服务器的 IP 地址；
3. **权威域名服务器（Authoritative DNS Server）**
   - 管理自己域名下主机的 IP 地址，比如 apple.com 权威域名服务器可以返回 www.apple.com 的 IP 地址。



除了上面三种DNS服务器，还有一种不在DNS层次结构之中，但是很重要的DNS服务器，就是**本地域名服务器**（也被称为**权威域名服务器**）。本地域名服务器是电脑解析时的**默认**域名服务器，即电脑中设置的首选 DNS 服务器和备选 DNS 服务器。常见的有电信、联通、谷歌、阿里等的本地 DNS 服务。

#### DNS解析过程

把**域名映射到IP**的过程，叫做**域名解析**。此过程是 计网7 中摘录。 真实情况要考虑缓存等。

域名到IP地址的解析过程要点如下：

当某一个应用进程需要把主机名解析为IP地址时，

1. 该应用进程就调用**解析程序（resolver）**，并成为DNS的一个客户，
2. 把待解析的域名放在DNS请求报文中，以**UDP 用户数据报**的格式发送给本地域名服务器（使用 UDP 是为了减少开销）。
3. 本地域名服务器在查找域名后，把对应的IP地址放在响应报文中返回。

#### 🔥DNS解析过程考虑缓存：

1. 首先搜索**浏览器DNS缓存**，缓存中维护一张域名与IP地址的对应表。
2. 如果没有命中，**系统DNS缓存**。 Mac上 `nslookup www.baidu.com`可以查看系统缓存
3.  hosts文件
4. 路由器缓存
5. 本地域名服务器（ISP）
6. 根域名服务器
7. 顶级域名服务器
8. 权威名服务器 



#### 🔥DNS查询过程

DNS的查询过程，按查询方式不同，分为**递归查询 和 迭代查询**。

**递归查询：**

<img src="https://zxd-blog-imgs.oss-cn-beijing.aliyuncs.com/imgs/20211209194714.png" alt="image-20211209194713872" style="zoom:50%;" />



**迭代查询:**

<img src="https://zxd-blog-imgs.oss-cn-beijing.aliyuncs.com/imgs/20211209194750.png" alt="image-20211209194750785" style="zoom:50%;" />

在实际的网络中，一般采用两段式查询过程，即先递归，后迭代。从本地主机到本地域名服务器采用递归查询，而从本地域名服务器到最终结果则采用迭代方式查询

递归查询：**主机和本地域名服务器之间的查询方式是递归查询。**

迭代查询：**本地域名服务器和其他域名服务器之间的查询方式是迭代查询**，防止根域名服务器压力过大。



### MAC

MAC地址 （Media Access Control Address）, 也称为局域网地址，可以唯一地标识一个网卡，也就同时标识了此网卡所属的设备。

IP 地址必须转换成MAC地址才能访问主机。


## 参考

1. 透视HTTP协议 from GeekTime
2. Web协议详解与抓包实战
3. 计算机网络 第7版 谢希仁
4. [超详细 DNS 协议解析](https://juejin.cn/post/6919755385330991112)
5. https://github.com/qiu-deqing/FE-interview